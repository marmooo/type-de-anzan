let hinted=!1;const countPanel=document.getElementById("countPanel"),infoPanel=document.getElementById("infoPanel"),playPanel=document.getElementById("playPanel"),scorePanel=document.getElementById("scorePanel"),gameTime=180;let endAudio,incorrectAudio,correctAudio;loadAudios();const AudioContext=window.AudioContext||window.webkitAudioContext,audioContext=new AudioContext;loadConfig();function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.dataset.theme="dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),delete document.documentElement.dataset.theme):(localStorage.setItem("darkMode",1),document.documentElement.dataset.theme="dark")}function playAudio(c,b){const a=audioContext.createBufferSource();if(a.buffer=c,b){const c=audioContext.createGain();c.gain.value=b,c.connect(audioContext.destination),a.connect(c),a.start()}else a.connect(audioContext.destination),a.start()}function unlockAudio(){audioContext.resume()}function loadAudio(a){return fetch(a).then(a=>a.arrayBuffer()).then(a=>new Promise((b,c)=>{audioContext.decodeAudioData(a,a=>{b(a)},a=>{c(a)})}))}function loadAudios(){promises=[loadAudio("mp3/end.mp3"),loadAudio("mp3/incorrect1.mp3"),loadAudio("mp3/correct3.mp3")],Promise.all(promises).then(a=>{endAudio=a[0],incorrectAudio=a[1],correctAudio=a[2]})}function getNumRange(a){switch(a){case 1:return[8,2,8,2,0,0,0,0];case 2:return[28,6,28,6,8,2,0,0];case 3:return[38,11,38,11,8,2,8,2];case 4:return[38,11,38,11,12,2,16,4];case 5:return[99,50,99,50,16,4,20,6];case 6:return[99,50,99,50,14,6,20,8];case 7:return[388,111,388,111,12,8,20,11];default:return[8888,1111,8888,1111,88,11,88,11]}}function generateData(){hinted=!1;const g=document.getElementById("gradeOption").selectedIndex+1,h=document.getElementById("courseOption").selectedIndex-1,a=getNumRange(g);let c,b,d,e,f;switch(h<0?g==1?f=Math.floor(Math.random()*2):g==2?f=Math.floor(Math.random()*3):f=Math.floor(Math.random()*4):f=h,f){case 0:c=Math.floor(Math.random()*a[0]+a[1]),b=Math.floor(Math.random()*a[0]+a[1]),d=c+b,e="＋";break;case 1:b=Math.floor(Math.random()*a[2]+a[3]),d=Math.floor(Math.random()*a[2]+a[3]),c=b+d,e="−";break;case 2:c=Math.floor(Math.random()*a[4]+a[5]),b=Math.floor(Math.random()*a[4]+a[5]),d=c*b,e="×";break;case 3:b=Math.floor(Math.random()*a[6]+a[7]),d=Math.floor(Math.random()*a[6]+a[7]),c=b*d,e="÷";break;default:console.log("error")}const i=document.getElementById("num");i.textContent=`${c}${e}${b}＝`,document.getElementById("reply").dataset.answer=d}let gameTimer;function startGameTimer(){clearInterval(gameTimer);const a=document.getElementById("time");initTime(),gameTimer=setInterval(()=>{const b=parseInt(a.textContent);b>0?a.textContent=b-1:(clearInterval(gameTimer),playAudio(endAudio),infoPanel.classList.add("d-none"),scorePanel.classList.remove("d-none"))},1e3)}function initTime(){document.getElementById("time").textContent=gameTime}let countdownTimer;function countdown(){clearTimeout(countdownTimer),countPanel.classList.remove("d-none"),infoPanel.classList.add("d-none"),scorePanel.classList.add("d-none");const a=document.getElementById("counter");a.textContent=3,countdownTimer=setInterval(()=>{const b=["skyblue","greenyellow","violet","tomato"];if(parseInt(a.textContent)>1){const c=parseInt(a.textContent)-1;a.style.backgroundColor=b[c],a.textContent=c}else clearTimeout(countdownTimer),countPanel.classList.add("d-none"),infoPanel.classList.remove("d-none"),document.getElementById("score").textContent=0,generateData(),startGameTimer()},1e3)}function initCalc(){const a=document.getElementById("reply"),b=document.getElementById("score");document.getElementById("be").onclick=()=>{hinted||(hinted=!0,a.textContent=a.dataset.answer),playPanel.style.pointerEvents="none",playAudio(incorrectAudio),setTimeout(()=>{a.textContent="",generateData(),playPanel.style.pointerEvents="auto"},3e3)},document.getElementById("bc").onclick=()=>{a.textContent=""};for(let c=0;c<10;c++)document.getElementById("b"+c).onclick=d=>{let c=a.textContent;c+=d.target.getAttribute("id").slice(-1),c.length>6&&(c=c.slice(1,7)),a.textContent=c;const e=a.dataset.answer;e==c&&(playAudio(correctAudio),a.textContent="",hinted||(b.textContent=parseInt(b.textContent)+1),generateData())}}initCalc(),generateData(),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("startButton").onclick=countdown,document.getElementById("restartButton").onclick=countdown,document.addEventListener("click",unlockAudio,{once:!0,useCapture:!0})